<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
    <link rel="stylesheet" href="./css/reset.css">
</head>
<body>
    <!-- <h1>api 다뤄보기</h1> -->
    <section id="se-3">
        <form>
            <p class="title"></p>
            <input type="text" id="title-input" placeholder="title">
            <button type="button" id="update-btn">변경</button>
        </form>
    </section>
    <script>
        // DOM 요소 선택 - querySelector로 HTML 요소를 JavaScript 변수에 저장
        const checkTitle = document.querySelector('#se-3 .title') // p.title 요소 선택
        const titleInput = document.querySelector('#title-input') // title 입력 필드 선택
        const updateBtn = document.querySelector('#update-btn') // 검색 버튼 선택
        
        // 검색 함수 - async/await 사용
        async function searchTitle() {
            // 입력 필드에서 검색어 가져오기 (trim()으로 앞뒤 공백 제거)
            const searchQuery = titleInput.value.trim()
            
            // 입력값 검증 - 빈 값이면 경고 메시지 표시하고 함수 종료
            if (!searchQuery) {
                alert('검색어를 입력해주세요.')
                return // 함수 실행 중단
            }
            
            try {
                // GET 요청으로 모든 todos 가져오기 (await로 응답 대기)
                const response = await fetch('https://jsonplaceholder.typicode.com/todos')
                // 응답을 JSON 형식으로 파싱 (await로 파싱 완료 대기)
                const todos = await response.json()
                
                // 검색어와 일치하는 todo 찾기 (대소문자 구분 없이 검색)
                const foundTodo = todos.find(todo => 
                    todo.title.toLowerCase().includes(searchQuery.toLowerCase())
                )
                
                // 검색 결과 처리
                if (foundTodo) {
                    // 일치하는 항목이 있으면 .title에 표시
                    checkTitle.textContent = foundTodo.title
                } else {
                    // 일치하는 항목이 없으면 메시지 표시
                    checkTitle.textContent = '검색 결과가 없습니다.'
                }
            } catch (error) {
                // 에러 발생 시 콘솔에 출력
                console.error('오류 발생:', error)
                alert('검색 중 오류가 발생했습니다.')
            }
        }
        
        // 검색 버튼 클릭 이벤트 리스너 등록
        updateBtn.addEventListener('click', searchTitle)
        
        // Enter 키 입력 시에도 검색 실행
        titleInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                e.preventDefault() // 폼 제출 방지
                searchTitle()
            }
        })
        
    </script>
</body>
</html>
